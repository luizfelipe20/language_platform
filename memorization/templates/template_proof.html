<!DOCTYPE html>
<html lang="pt-BR" data-bs-theme="dark">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Multiple Choice Test</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-dark text-light">

<div class="container py-5">

  <h1 class="text-center fw-bold mb-5">Logged in {{minutes}}:00</h1>
  <span class="text-center fw-bold mb-5">
    <a href="{{servidor}}/admin" target="_blank">admin home</a>
  </span>
  
  <form method="POST" class="card bg-secondary-subtle p-4 rounded-4 shadow">
    {% csrf_token %}

    <!-- AUDIO ------------------------------------------------------>
    {% if short_text_audio %}
    <h4 class="fw-bold mb-3">Audio</h4>

    <audio id="meuAudio" controls preload="metadata" class="w-100 rounded mb-2">
      <source src="{{short_text_audio}}" type="audio/mpeg" />
    </audio>

    <div class="d-flex align-items-center gap-2 mb-4">
      <button id="playBtn" type="button" class="btn btn-success">▶ Play</button>
      <button id="pauseBtn" type="button" class="btn btn-danger">⏸ Pause</button>
      <span id="tempo" class="ms-auto">00:00 / 00:00</span>
    </div>
    {% endif %}

    <!-- ACCORDION DE TEXTOS ---------------------------------------->
    <div class="accordion mb-4" id="accordionTextos">

      {% if list_short_text_obj %}
      <div class="accordion-item bg-dark text-light">
        <h2 class="accordion-header">
          <button class="accordion-button collapsed bg-dark text-light" type="button"
                  data-bs-toggle="collapse" data-bs-target="#colListShort">
            Additional Text Blocks
          </button>
        </h2>
        <div id="colListShort" class="accordion-collapse collapse" data-bs-parent="#accordionTextos">
          <div class="accordion-body">
            {% for obj in list_short_text_obj %}
              <div class="alert alert-secondary">{{obj}}</div>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endif %}

      {% if short_text %}
      <div class="accordion-item bg-dark text-light">
        <h2 class="accordion-header">
          <button class="accordion-button collapsed bg-dark text-light" type="button"
                  data-bs-toggle="collapse" data-bs-target="#colShort">
            Main Text
          </button>
        </h2>
        <div id="colShort" class="accordion-collapse collapse" data-bs-parent="#accordionTextos">
          <div class="accordion-body">
            <pre style="white-space: pre-wrap;overflow-wrap: break-word;max-width: 100%;">
              {{short_text}}
            </pre>
          </div>
        </div>
      </div>
      {% endif %}

      {% if short_text_translation %}
      <div class="accordion-item bg-dark text-light">
        <h2 class="accordion-header">
          <button class="accordion-button collapsed bg-dark text-light" type="button"
                  data-bs-toggle="collapse" data-bs-target="#colTranslation">
            Translation
          </button>
        </h2>
        <div id="colTranslation" class="accordion-collapse collapse" data-bs-parent="#accordionTextos">
          <div class="accordion-body">
            {{short_text_translation|safe}}
          </div>
        </div>
      </div>
      {% endif %}

      {% if short_text_phonetic_transcription %}
      <div class="accordion-item bg-dark text-light">
        <h2 class="accordion-header">
          <button class="accordion-button collapsed bg-dark text-light" type="button"
                  data-bs-toggle="collapse" data-bs-target="#colPhonetic">
            Phonetic Transcription
          </button>
        </h2>
        <div id="colPhonetic" class="accordion-collapse collapse" data-bs-parent="#accordionTextos">
          <div class="accordion-body">
            {{short_text_phonetic_transcription|safe}}
          </div>
        </div>
      </div>
      {% endif %}

    </div>

    <!-- QUESTION --------------------------------------------------->
    <h4 class="fw-semibold mb-3">{{sentence}}</h4>

    <!-- OPTIONS ---------------------------------------------------->
    <div class="list-group mb-4">
      {% for option in options %}
        <label class="list-group-item bg-dark text-light border-light">
          <input type="radio" class="form-check-input me-2" name="answer_option" value="{{option.id}}">
          {{option.term}}
        </label>
      {% endfor %}
    </div>

    <input type="hidden" name="instance_id" value="{{instance_id}}">

    <!-- SUBMIT ----------------------------------------------------->
    <button type="submit" class="btn btn-lg btn-primary w-100 rounded-4 fw-bold shadow">
      Send Reply
    </button>

  </form>

</div>

<!-- SCRIPT DO ÁUDIO --------------------------------------------->
<script>
  const audio = document.getElementById('meuAudio');
  const playBtn = document.getElementById('playBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const tempo = document.getElementById('tempo');

  if (audio) {
    playBtn.addEventListener('click', () => audio.play());
    pauseBtn.addEventListener('click', () => audio.pause());

    function formatarSegundos(s) {
      const m = Math.floor(s / 60).toString().padStart(2, '0');
      const sec = Math.floor(s % 60).toString().padStart(2, '0');
      return `${m}:${sec}`;
    }

    audio.addEventListener('loadedmetadata', () => {
      tempo.textContent = `00:00 / ${formatarSegundos(audio.duration)}`;
    });

    audio.addEventListener('timeupdate', () => {
      tempo.textContent = `${formatarSegundos(audio.currentTime)} / ${formatarSegundos(audio.duration)}`;
    });
  }
</script>

<!-- Bootstrap JS ------------------------------------------------->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
